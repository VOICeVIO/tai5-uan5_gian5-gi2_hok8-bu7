# 環境設定
## Ubuntu14.04/Mint17快速架設
### 設定環境
其中最後一個指令，編譯moses需要半小時至一小時以上，剩下的步驟可以邊做
```bash
sudo apt-get install -y python3 python-virtualenv g++ python3-dev libyaml-dev libxslt1-dev git subversion automake libtool zlib1g-dev libboost-all-dev libbz2-dev liblzma-dev libgoogle-perftools-dev libxmlrpc-c++.*-dev libpq-dev postgresql postgresql-contrib # 安裝套件
git clone https://github.com/sih4sing5hong5/hok8-bu7.git
cd hok8-bu7
virtualenv --python=python3 venv; . venv/bin/activate; pip install --upgrade pip # 設置環境檔
pip install tai5-uan5_gian5-gi2_hok8-bu7
echo 'from 臺灣言語工具.翻譯.摩西工具.安裝摩西翻譯佮相關程式 import 安裝摩西翻譯佮相關程式; 安裝摩西翻譯佮相關程式.安裝moses(編譯CPU數=3); 安裝摩西翻譯佮相關程式.安裝gizapp()' | python
```

### 建資料庫
設定使用者佮密碼
```bash
sudo -u postgres createuser --superuser $USER
sudo -u postgres createdb $USER
psql
    \password
```
佇`hok8-bu7/setting.py`改使用者帳號和資料庫密碼
```python3
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql_psycopg2',
        'NAME': '$USER', # Linux's username
        'USER': '$USER', # Linux's username
        'PASSWORD': 'Taiwanese', # 剛輸入的密碼
        'HOST': 'localhost',
        'PORT': '',
    }
}
```
這樣接下來再匯入資料，就可以匯入資料和使用服務了！！

## 詳細設定步驟
### 作業系統
需要Unix，推薦[Mint Linux](http://www.linuxmint.com/download.php)佮[Ubuntu Linux](http://www.ubuntu-tw.org/modules/tinyd0/)

Ubuntu/Mint 套件安裝指令
```bash
sudo apt-get install -y python3 python-virtualenv # python虛擬環境
sudo apt-get install -y g++ python3-dev libyaml-dev libxslt1-dev # 臺灣言語資料庫
sudo apt-get install -y git subversion automake libtool zlib1g-dev libboost-all-dev libbz2-dev liblzma-dev libgoogle-perftools-dev libxmlrpc-c++.*-dev # moses, libxmlrpc for mosesserver
sudo apt-get install -y libpq-dev postgresql postgresql-contrib # postgres
```

### 虛擬環境設定
請先安裝python3佮[virtualenv](https://virtualenv.readthedocs.org/en/latest/)
```bash
virtualenv --python=python3 venv; . venv/bin/activate; pip install --upgrade pip # 設置環境檔
```

### 開啟環境
每次使用前都需要執行
```bash
. venv/bin/activate # 載入環境
```

### 安裝套件
```bash
pip install tai5-uan5_gian5-gi2_hok8-bu7
```

### 編譯翻譯模型
可參考臺灣言語工具的[Moses摩西翻譯](http://tai5-uan5-gian5-gi2-kang1-ku7.readthedocs.org/zh_TW/latest/機器翻譯.html)。

執行以下`python`腳本
```python3
from 臺灣言語工具.翻譯.摩西工具.安裝摩西翻譯佮相關程式 import 安裝摩西翻譯佮相關程式
安裝摩西翻譯佮相關程式.安裝moses(編譯CPU數=4)
安裝摩西翻譯佮相關程式.安裝gizapp()
```

### 設定
使用臺灣言語服務，時區和前端的cors設定。

在Django的`settings.py`設定檔*最底下*加上
```
INSTALLED_APPS = +(
    'corsheaders',
    '臺灣言語資料庫',
    '臺灣言語服務',
)

MIDDLEWARE_CLASSES = +(
    'corsheaders.middleware.CorsMiddleware',
)
CORS_ORIGIN_REGEX_WHITELIST = ('^.*$', )
CORS_ALLOW_CREDENTIALS = True

TIME_ZONE = 'Asia/Taipei'
```

網址對應`urls.py`加上對應路徑
```python3
urlpatterns = patterns(
    ...
    url(r'^', include('臺灣言語服務.網址')),
    ...
)
```

### 使用Postgres
建資料庫，請設定密碼
```bash
sudo -u postgres createuser --superuser $USER
sudo -u postgres createdb $USER
psql
    \password
```
佇`setting.py`改使用者帳號和資料庫密碼
```python3
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql_psycopg2',
        'NAME': '$USER', # Linux's username
        'USER': '$USER', # Linux's username
        'PASSWORD': 'Taiwanese', # 剛輸入的密碼
        'HOST': 'localhost',
        'PORT': '',
    }
}
```
有任何疑問可以看臺灣言語資料庫的[使用Postgres](http://tai5-uan5-gian5-gi2-tsu1-liau7-khoo3.readthedocs.org/zh_TW/latest/%E4%BD%BF%E7%94%A8Postgres.html)的說明。
