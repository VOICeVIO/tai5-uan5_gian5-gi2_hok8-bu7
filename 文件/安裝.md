# 環境設定

## 作業系統
需要Unix，推薦[Mint Linux](http://www.linuxmint.com/download.php)佮[Ubuntu Linux](http://www.ubuntu-tw.org/modules/tinyd0/)

Ubuntu/Mint 套件安裝指令
```bash
sudo apt-get install -y python3 python-virtualenv # python虛擬環境
sudo apt-get install -y g++ git subversion automake libtool zlib1g-dev libboost-all-dev libbz2-dev liblzma-dev python3-dev libgoogle-perftools-dev libxmlrpc-c++.*-dev # moses, libxmlrpc for mosesserver
sudo apt-get install -y libpq-dev python3-dev postgresql postgresql-contrib # postgres
```

## 虛擬環境設定
請先安裝python3佮[virtualenv](https://virtualenv.readthedocs.org/en/latest/)
```bash
virtualenv venv --python python3 # 設置環境檔
. venv/bin/activate # 載入環境
```

## 開啟環境
每次使用前都需要執行
```bash
. venv/bin/activate # 載入環境
```

## 使用Postgres
強烈建議使用pgsql，sqlite3速度過慢。
請看臺灣言語資料庫的[使用Postgres](http://tai5-uan5-gian5-gi2-tsu1-liau7-khoo3.readthedocs.org/zh_TW/latest/%E4%BD%BF%E7%94%A8Postgres.html)的說明。

## 安裝套件
```bash
pip install tai5-uan5_gian5-gi2_hok8-bu7
pip install git+https://github.com/kpu/kenlm.git#egg=kenlm
pip install git+https://github.com/sih4sing5hong5/hts_engine_python.git#egg=htsengine
pip install git+https://github.com/conrado/libavwrapper@6409123ee24df823a5ee0bac7a08043e6b317721#egg=libavwrapper
```

## 編譯翻譯模型
可參考臺灣言語工具的[Moses摩西翻譯](http://tai5-uan5-gian5-gi2-kang1-ku7.readthedocs.org/zh_TW/latest/機器翻譯.html)。
```bash
sudo apt-get install -y g++ git subversion automake libtool zlib1g-dev libboost-all-dev libbz2-dev liblzma-dev python3-dev libgoogle-perftools-dev libxmlrpc-c++.*-dev # moses, libxmlrpc for mosesserver
```
執行以下`python`腳本
```python3
from 臺灣言語工具.翻譯.摩西工具.安裝摩西翻譯佮相關程式 import 安裝摩西翻譯佮相關程式
安裝程式 = 安裝摩西翻譯佮相關程式()
安裝程式.安裝moses(編譯CPU數=4)
安裝程式.安裝gizapp()
```

## 設定
使用臺灣言語服務，時區和前端的cors設定。

在Django的`settings.py`設定檔*最底下*加上
```
INSTALLED_APPS = +(
    'corsheaders',
    '臺灣言語資料庫',
    '臺灣言語服務',
)

MIDDLEWARE_CLASSES = +(
    'corsheaders.middleware.CorsMiddleware',
)
CORS_ORIGIN_REGEX_WHITELIST = ('^.*$', )
CORS_ALLOW_CREDENTIALS = True

TIME_ZONE = 'Asia/Taipei'
```

網址對應`urls.py`加上對應路徑
```python3
urlpatterns = patterns(
    ...
    url(r'^', include('臺灣言語服務.網址')),
    ...
)
```